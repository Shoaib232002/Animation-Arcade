#!/bin/sh
set -e

echo "=== Running ESLint ==="
npx eslint .

echo "=== Running Stylelint ==="
npx stylelint "**/*.css" --allow-empty-input

echo "=== Running Tests ==="
STAGED_JS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.js$' | grep -v -E '(test|spec|config|server)\.js$' || true)

if [ -n "$STAGED_JS_FILES" ]; then
  node --experimental-vm-modules node_modules/jest/bin/jest.js --bail --findRelatedTests $STAGED_JS_FILES --passWithNoTests
else
  npm test
fi

echo "All checks passed!"